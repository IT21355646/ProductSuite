@{
    ViewData["Title"] = "Your Cart";
}

<div class="container my-5">
    <h2 class="mb-4">Shopping Cart</h2>
    <div id="cartContainer">
        <table class="table table-bordered align-middle">
            <thead class="table-light">
                <tr>
                    <th>Product</th>
                    <th>Price</th>
                    <th width="120px">Quantity</th>
                    <th>Total</th>
                    <th></th>
                </tr>
            </thead>
            <tbody id="cartTableBody">
                <!-- Cart rows go here -->
            </tbody>
        </table>
        <div class="text-end">
            <h4>Grand Total: $<span id="grandTotal">0</span></h4>
            <button class="btn btn-success mt-3">Checkout</button>
        </div>
    </div>
    <div id="emptyCartMessage" class="alert alert-info text-center d-none">
        Your cart is empty. <a href="/Products">Browse products</a>.
    </div>
</div>

@section Scripts {
<script>
$(document).ready(function() {
    renderCart();

    function renderCart() {
        let cart = JSON.parse(localStorage.getItem('cart') || '[]');
        $('#cartTableBody').empty();

        if (cart.length === 0) {
            $('#cartContainer').hide();
            $('#emptyCartMessage').removeClass('d-none');
            updateNavbarCartCount();
            return;
        }

        let grandTotal = 0;
        cart.forEach((item, index) => {
            const total = item.price * item.quantity;
            grandTotal += total;

            $('#cartTableBody').append(`
                <tr>
                    <td>
                        <img src="${item.thumbnail}" alt="${item.title}" style="width:50px;height:50px;object-fit:cover;" class="me-2">
                        ${item.title}
                    </td>
                    <td>$${item.price}</td>
                    <td>
                        <input type="number" class="form-control quantity-input" data-index="${index}" value="${item.quantity}" min="1">
                    </td>
                    <td>$${total.toFixed(2)}</td>
                    <td>
                        <button class="btn btn-danger btn-sm remove-item" data-index="${index}">Remove</button>
                    </td>
                </tr>
            `);
        });

        $('#grandTotal').text(grandTotal.toFixed(2));
        $('#cartContainer').show();
        $('#emptyCartMessage').addClass('d-none');
        updateNavbarCartCount();
    }

    // Quantity change
    $(document).on('change', '.quantity-input', function() {
        let cart = JSON.parse(localStorage.getItem('cart') || '[]');
        const index = $(this).data('index');
        cart[index].quantity = parseInt($(this).val()) || 1;
        localStorage.setItem('cart', JSON.stringify(cart));
        renderCart();
    });

    // Remove item
    $(document).on('click', '.remove-item', function() {
        let cart = JSON.parse(localStorage.getItem('cart') || '[]');
        const index = $(this).data('index');
        cart.splice(index, 1);
        localStorage.setItem('cart', JSON.stringify(cart));
        renderCart();
    });

    // Update nav badge
    function updateNavbarCartCount() {
        const cart = JSON.parse(localStorage.getItem('cart') || '[]');
        const count = cart.reduce((acc, c) => acc + c.quantity, 0);
        $('#cart-count').text(count);
    }
});
</script>
}
