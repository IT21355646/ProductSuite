@{
    ViewData["Title"] = "Your Cart";
}

<div class="container my-5">
    <h2 class="mb-4">Shopping Cart</h2>

    <!-- Cart Table -->
    <div class="table-responsive">
        <table class="table table-bordered align-middle text-center">
            <thead class="table-dark">
                <tr>
                    <th>Image</th>
                    <th>Product</th>
                    <th>Price</th>
                    <th>Quantity</th>
                    <th>Total</th>
                    <th></th>
                </tr>
            </thead>
            <tbody id="cartTableBody">
                <!-- Cart items will be loaded dynamically -->
            </tbody>
        </table>
    </div>

    <!-- Cart Summary -->
    <div class="d-flex justify-content-end mt-4">
        <div class="card shadow p-4" style="width: 350px;">
            <h5 class="mb-3">Order Summary</h5>
            <p class="d-flex justify-content-between">
                <span>Subtotal:</span>
                <strong id="cartSubtotal">$0.00</strong>
            </p>
            <p class="d-flex justify-content-between">
                <span>Shipping:</span>
                <strong>Free</strong>
            </p>
            <hr>
            <p class="d-flex justify-content-between fs-5">
                <span>Total:</span>
                <strong id="cartTotal">$0.00</strong>
            </p>
            <button id="proceedCheckoutBtn" class="btn btn-success w-100 mt-3">Proceed to Checkout</button>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Load Cart
        function loadCart() {
            let cart = JSON.parse(localStorage.getItem("cart")) || [];
            let cartTableBody = $("#cartTableBody");
            let subtotal = 0;

            cartTableBody.empty();

            if (cart.length === 0) {
                cartTableBody.append(`
                    <tr>
                        <td colspan="6" class="text-center">Your cart is empty.</td>
                    </tr>
                `);
            } else {
                cart.forEach((item, index) => {
                    let total = item.price * item.quantity;
                    subtotal += total;

                    cartTableBody.append(`
                        <tr>
                            <td><img src="${item.image}" alt="${item.title}" style="width: 60px; height: auto;"></td>
                            <td>${item.title}</td>
                            <td>$${item.price.toFixed(2)}</td>
                            <td>
                                <input type="number" min="1" value="${item.quantity}" 
                                    class="form-control w-50 mx-auto update-qty" 
                                    data-index="${index}">
                            </td>
                            <td>$${total.toFixed(2)}</td>
                            <td>
                                <button class="btn btn-danger btn-sm remove-item" data-index="${index}">
                                    Remove
                                </button>
                            </td>
                        </tr>
                    `);
                });
            }

            $("#cartSubtotal").text(`$${subtotal.toFixed(2)}`);
            $("#cartTotal").text(`$${subtotal.toFixed(2)}`);
        }

        // Update Quantity
        $(document).on("change", ".update-qty", function () {
            let index = $(this).data("index");
            let cart = JSON.parse(localStorage.getItem("cart")) || [];
            cart[index].quantity = parseInt($(this).val());
            localStorage.setItem("cart", JSON.stringify(cart));
            loadCart();
        });

        // Remove Item
        $(document).on("click", ".remove-item", function () {
            let index = $(this).data("index");
            let cart = JSON.parse(localStorage.getItem("cart")) || [];
            cart.splice(index, 1);
            localStorage.setItem("cart", JSON.stringify(cart));
            loadCart();
        });

        // Proceed to Checkout button
        $(document).on("click", ".btn-success", function() {
            // Redirect to Checkout page
            window.location.href = "/Products/Checkout";
        });


        // Initial Load
        $(document).ready(function () {
            loadCart();
        });
    </script>
}
